# apiVersion: networking.k8s.io/v1
# kind: Ingress
# metadata:
#   name: app-ingress
#   namespace: apps
# spec:
#   ingressClassName: nginx
#   defaultBackend:
#     service:
#       name: nginx-ingress-error-svc
#       port:
#         number: 80
#   rules:
#     - host: test.focuslearningorg.com
#       http:
#         paths:
#           - path: /
#             pathType: Prefix
#             backend:
#               service:
#                 name: nginx-ingress-svc
#                 port:
#                   number: 80

---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: listener-http-80
  # namespace: kube-system
  annotations:
    ## This Ingress must define at least 1 rule so it is explicit rule the
    ## same as default in `aws_lb.ingress.default_action`
    alb.ingress.kubernetes.io/actions.default: |
      {
        "type": "fixed-response",
        "fixedResponseConfig": {
          "contentType": "text/plain",
          "statusCode": "404",
          "messageBody": "Hiiii"
        }
      }
    ## Name of the ALB
    alb.ingress.kubernetes.io/group.name: dtp-eks-cluster-ingress
    ## The lowest possible priority
    alb.ingress.kubernetes.io/group.order: "100"
    ## Name of the ALB
    alb.ingress.kubernetes.io/load-balancer-name: dtp-eks-cluster-ingress
    ## Must be the same as in `aws_lb.ingress.internal`
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/healthcheck-protocol: HTTP
    alb.ingress.kubernetes.io/healthcheck-port: "30996" # Make sure you add the NodePort over here
    alb.ingress.kubernetes.io/healthcheck-path: / # Put the path of readiness probe over here
    alb.ingress.kubernetes.io/healthcheck-interval-seconds: '30'
    alb.ingress.kubernetes.io/healthcheck-timeout-seconds: '5'
    alb.ingress.kubernetes.io/success-codes: '200'
    alb.ingress.kubernetes.io/healthy-threshold-count: '5'
    alb.ingress.kubernetes.io/unhealthy-threshold-count: '2'
    ## Uses AWS Load Balancer Controller
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP":80}]'
    kubernetes.io/ingress.class: alb
    # alb.ingress.kubernetes.io/actions.forward-single-tg: >
    #   {"type":"forward","targetGroupARN": "arn:aws:elasticloadbalancing:ap-southeast-1:806263047535:targetgroup/afsb-dtp-tg-1/f9e71ab5bdfa3e5f"}
    kubernetes.io/ingress.class: "nginx"
spec:
  ingressClassName: nginx
  rules:
    - host: test.focuslearningorg.com
      http:
          paths:
            - pathType: Prefix
              path: /*
              backend:
                service:
                  ## The same ID as in `alb.ingress.kubernetes.io/actions.ID`
                  # name: app-svc
                  name: app-svc
                  port:
                    ## Must be literally `use-annotation`
                    # name: use-annotation
                    number: 80